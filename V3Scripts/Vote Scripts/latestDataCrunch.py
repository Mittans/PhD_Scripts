#What this file does?
#
#


import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
sns.set_theme(style="darkgrid")
import pickle
from datetime import datetime as dt
import scipy as sp
import random

class episodeClass:
    def __init__(self):
        self.episode = ''
        self.score = 0
        self.comments = 0
        self.group = ''
        self.timeseries = 0
        self.time = dt.today()

episodelist = open("timeseriesPickle1.pickle", "rb")
dfTS = pickle.load(episodelist)


#Score, Comments, Group, TimeSeries, TimeIndex


episodelist.close()

fivemins = pd.timedelta_range(0, periods=13, freq='5T')
tenmins = pd.timedelta_range('1H10T', periods=30, freq='10T')
fifteenmins = pd.timedelta_range('6H20T', periods=54, freq='20T')

totalmins = fivemins.append(tenmins).append(fifteenmins)

print(dfTS.columns)
dfTS = dfTS.astype({"Score": float, "Comments": float, "Group": str, "TimeSeries": int, "TimeIndex": 'timedelta64[ns]'})

dfTSDiff = dfTS[["Score","Comments"]]
dfTSDiff2 = dfTS[["Group", "TimeSeries", "TimeIndex"]]
dfTSDiff1 = dfTSDiff.diff()
dfTSDiff3 = dfTSDiff2.merge(dfTSDiff1)



sns.relplot(data=dfTS, x="TimeSeries", y="Score", kind="line", hue='Group')
plt.savefig("noontide.png")
plt.show()




sns.relplot(data=dfTSDiff, x="TimeSeries", y="Score", kind="line", hue='Group')
plt.savefig("noontideDiff.png")
plt.show()

sns.relplot(data=dfTS, x="TimeSeries", y="Comments", kind="line", hue='Group')
plt.savefig("eventide.png")
plt.show()



dfTS2 = dfTS[dfTS['TimeSeries']==96]

sns.displot(data=dfTS2, x="Comments", y="Score", hue="Group").set(xlim=(0,150), ylim=(0,4000) )
plt.show()

g = sns.lmplot(x="TimeSeries", y="Score", data=dfTS, hue="Group", x_estimator=np.mean, ci=None, scatter_kws={"s": 10}, order=2 )

def annotate(data, **kws):
    r, p = sp.stats.pearsonr(data['TimeSeries'], data['Score'])
    ax = plt.gca()
    ax.text(0.05, random.uniform(0.7, 0.9), 'r={:.2f}, p={:.2g}'.format(r, p),
            transform=ax.transAxes)
g.map_dataframe(annotate)
plt.show()

boostedVotes = [357,239,44,386,46,63,308,41,1168,395,892,1286,293,59,2101,63,56,67,611,53,836,449,35,2004,525,176,187,11,126,288,495,32,52,287,31,19,285,202,156,119,1624,254,61,1054,252,23,99,194,42,410,244,145,247,795,477,2429,396,255,3229,35,2456,569,670,210,1617,79,150,109,80,64,524,149,1327,1378,199,442,204,439,309,114,389,122,173,308,45,543,1076,782,215,34,148,418,196,440,58,440,163,246,4835,107,152,178,262,143,229,2479,786,232,167,1579,332,83,151,46,133,1978,90,217,417,2955,19,24,279,95,5458,250,780,319,384,2230,410,44,212,55,682,72,62,87,135,25,833,1233,95,37,270,83,670,542,690,223,88,198,4474,200,2648,1729,1465,22,192,84,26,41,424,65,989,612,16,1022,115,96,758,41,302,257,32,45,809,52,47,47,2272,298,1311,909,1772,632,99,1538,582,2752,1612,47,276,768,30,45,536,125,23,68,856,147,76,156,77,171,3382,202,1247,639,248,45,397,458,302,177,94,1191,42,619,74,256,125,243,42,44,45,111,309,79,195,60,51,86,30,1742,64,1340,48,60,23,130,385,162,73,2040,41,38,192,841,126,20,194,31,88,104,634,147,70,166,175,545,30,65,43,236,47,739,35,116,39,274,18,58,419,932,23,724,23,31,260,138,40,400,601,18,28,14,300,66,499,80,70,26,112,48,131,292,455,30,1323,582,396,156,145,516,568,91,25,34,33,29,29,25,153,63,97,1625,33,23,24,183,218,104,592,98,242,137,610,29,1254,82,37,28,51,113,38,20,22,28,28,42,28,29,39,19,267,33,45,247,46,155,52,98,50,186,53,37,149,87,109,163,95,1017,119,45,40,30,407,1330,73,255,39,24,33,28,27,35,55,21,50,47,40,32,40,32,39,348,28,31,64,57,29,53,36,1244,176,25,580,371,116,444,80,252,38,43,34,25,67,145,23,21,460,43,791,785,928,48,236,76,92,3371,25,672,22,1480,118,76,6567,355,767,3555,11,2208,252,58,254,40,88,1482,105,72,60,2252,34,99,26,641,36,245,28,1476,484,412,521,60,39,362,1067,123,155,3137,2279,477,479,15,81,40,35,21,225,31,148,41,93,59,39,19,10,12,14,97,26,40,19,39,20,37,563,1031,45,46,39,36,29,826,31,147,218,797,66,29,283,108,32,250,27,83,23,40,30,129,224,1515,45,161,285,236,189,1284,253,207,172,632,2333,829,712,1922,33,100,66,1668,332,476,30,133,702,58,57,29,37,274,319,99,25,41,131,199,325,2699,69,14,816,1562,2099,254,63,26,20,38,329,293,767,38,1443,200,50,118,235,87,37,145,31,1714,451,104,57,3576,62,45,111,29,29,2022,68,52,3741,34,26,23,33,46,2254,28,30,44,36,25,32,22,30,23,38,37,30,48,378,893,25,142,1880,39,22]
boostedComments = [7,1,0,3,1,2,1,2,20,41,18,23,15,1,24,8,1,3,14,5,11,2,0,31,8,16,0,0,1,8,2,0,2,5,3,2,2,1,2,1,320,14,0,17,7,0,4,2,3,3,2,28,19,7,4,32,3,2,90,7,113,1,6,8,8,0,1,2,0,0,10,4,32,52,0,4,0,31,4,0,12,0,0,8,0,8,5,6,2,1,0,6,26,9,2,8,0,14,154,5,5,2,4,2,1,8,3,19,0,14,13,13,5,0,3,6,2,3,23,100,7,0,2,0,292,16,12,5,6,35,3,0,6,0,10,5,0,1,1,0,0,25,3,5,6,3,14,11,9,4,1,6,326,1,92,11,13,0,31,2,5,1,5,0,8,12,12,46,2,0,45,0,7,3,4,3,26,1,5,1,37,2,51,40,49,7,1,76,28,174,93,0,1,13,4,5,10,5,5,2,1,0,1,4,0,1,134,49,36,7,7,0,4,2,1,2,6,7,7,2,0,7,2,2,0,2,3,9,1,0,0,0,2,0,2,15,0,1,2,0,8,2,16,3,2,14,4,0,0,2,2,1,0,2,0,2,8,1,2,0,8,5,1,0,4,1,1,14,0,1,0,6,1,1,3,12,1,12,4,0,10,2,2,8,20,2,10,1,4,7,0,5,1,1,17,1,5,1,19,2,32,5,1,18,30,6,27,2,3,1,3,0,2,9,20,1,9,13,2,22,12,2,3,13,7,1,6,3,9,0,13,5,4,1,13,3,5,3,0,7,2,0,2,0,0,9,11,1,1,2,0,6,1,5,0,2,2,0,3,2,12,12,1,7,2,0,1,0,6,8,2,4,15,1,1,2,4,1,0,10,6,1,9,1,2,6,5,8,0,1,1,4,11,2,10,89,0,4,41,2,2,11,1,3,4,2,5,0,1,4,2,18,8,4,19,18,4,2,2,2,5,69,1,30,11,27,3,6,168,1,47,66,0,32,1,1,3,0,12,55,4,0,0,62,2,6,3,8,1,3,1,44,4,8,1,1,0,0,18,0,15,41,104,8,2,1,7,1,11,1,4,4,16,19,2,2,6,0,23,0,4,3,5,2,11,0,15,3,9,9,2,7,4,3,0,22,2,10,0,5,1,1,9,1,1,16,0,2,7,1,0,0,4,13,1,19,7,8,9,7,9,0,7,16,88,25,42,57,9,13,1,63,13,13,1,0,14,15,2,6,4,4,3,5,14,0,8,16,1,45,8,0,30,28,28,6,4,2,1,2,22,12,4,3,33,17,2,1,7,14,6,4,4,26,25,6,1,34,8,3,1,2,0,29,2,1,120,6,2,0,0,1,19,1,0,2,0,0,3,0,2,11,1,2,0,2,3,64,2,2,33,1,1,]

controlVotes = [32,21,20,56,16,67,185,41,27,167,942,24,16,36,240,23,19,27,53,339,15,20,19,31,21,4,11,12,23,23,24,119,12,13,23,18,20,14,11,24,12,22,11,576,25,32,23,30,385,32,51,378,10,43,259,25,245,21,54,24,31,51,949,33,813,136,31,78,27,11,40,3126,22,62,759,33,46,15,164,386,12,11,17,17,53,22,18,22,175,27,36,17,38,23,174,15,10,15,9,12,33,17,17,145,3,57,20,60,31,29,59,3,54,21,12,12,66,20,33,14,15,10,13,22,26,14,21,77,22,25,23,117,15,88,314,34,18,18,24,23,12,19,29,14,18,21,27,68,75,277,28,57,44,155,14,91,27,16,25,25,6,9,27,23,12,21,15,17,19,9,186,42,15,71,8,16,20,15,126,626,32,1894,28,1268,133,28,29,104,392,38,153,39,21,24,27,58,31,35,32,25,17,16,302,19,39,23,33,448,27,18,23,106,29,27,5593,36,13,20,26,115,18,14,31,62,282,19,31,54,24,56,16,129,14,20,41,14,24,24,26,20,156,14,60,49,26,17,12,45,23,22,22,14,26,33,16,22,46,35,123,27,21,46,22,16,15,94,15,14,70,53,25,9,13,23,35,36,404,17,25,22,16,410,41,41,13,9,38,12,14,320,4,2649,52,112,33,24,15,27,318,15,78,12,12,309,11,26,35,9,8,19,13,18,11,20,201,188,523,48,29,26,10,17,40,56,86,375,167,137,467,12,22,173,29,6,36,28,100,11,25,18,8,12,27,17,8,23,22,21,28,42,27,46,27,24,220,56,61,38,21,1123,10,31,48,29,50,43,75,126,78,25,648,31,26,1400,19,19,28,38,27,152,22,11,24,441,475,22,38,22,32,650,44,36,15,18,26,20,23,59,27,46,19,31,19,17,21,25,25,21,41,1492,15,37,35,49,27,29,597,984,40,21,26,125,27,193,18,17,11,24,83,54,748,77,475,166,20,14,2,44,22,42,228,21,447,18,36,17,7,11,12,38,16,20,13,18,350,16,42,15,35,10,17,8,11,16,28,11,157,24,173,11,4,64,16,11,32,150,35,12,36,32,18,42,69,911,3,56,11,24,6,36,13,29,31,54,31,23,23,16,21,32,1134,17,11,21,23,22,19,23,24,24,24,17,102,19,12,601,27,20,132,19,20,68,17,20,108,45,14,27,141,96,407,529,74,29,27,46,38,15,491,18,20,1074,6949,22,8,15,55,21,39,24,421,14,20,25,47,163,15,20,28,13,16,18,37,330,4946,37,9,32,22,22,16,36,15,199,35,15,28,28,24,131,18,29,737,148,12,176,9,20,20,6,93,4,146,23,22,6,40,26,5,19,15,0,19,21,24,38,98,39,23,36,18,25,23]
controlComments = [2,1,5,0,1,0,3,1,0,2,17,0,0,1,6,3,4,0,1,8,0,0,0,5,0,1,0,0,0,4,17,13,0,1,1,2,0,2,1,4,0,1,0,21,0,3,0,6,3,1,2,9,0,0,6,1,11,0,5,1,5,0,11,0,3,3,0,6,0,0,0,172,0,0,12,1,1,0,0,13,1,0,0,0,3,2,1,3,5,2,2,3,2,1,3,1,1,5,2,0,2,1,1,5,2,1,5,2,7,0,1,0,0,0,0,0,1,1,0,1,1,0,3,0,1,3,4,3,0,2,2,5,0,0,2,1,0,0,7,0,0,2,1,4,2,0,0,0,4,2,1,0,1,18,1,3,2,0,0,0,0,0,1,1,4,14,2,1,1,16,7,7,1,2,2,0,1,2,0,17,2,47,0,53,1,1,2,2,3,1,1,4,0,2,0,4,0,1,4,0,0,1,3,6,0,2,1,5,9,1,2,6,0,0,280,2,0,1,0,5,0,2,2,3,14,3,4,1,0,0,0,5,3,2,7,0,0,0,0,2,1,0,11,1,0,0,1,0,0,3,0,1,0,1,1,0,1,6,1,2,1,0,0,1,0,7,1,0,0,1,0,1,2,2,1,3,14,2,2,2,1,21,2,0,0,3,4,1,5,4,0,52,4,1,2,0,1,4,10,8,4,2,1,4,3,4,2,0,7,0,2,1,0,1,9,2,8,1,5,0,2,0,0,2,1,10,3,2,11,0,2,6,0,4,17,9,2,1,1,0,2,0,1,1,0,4,0,0,0,2,0,2,0,0,10,0,4,1,2,13,1,3,7,1,1,0,10,9,2,1,35,6,0,9,0,3,1,2,0,9,0,1,1,9,14,1,0,0,1,10,0,0,6,0,2,0,2,5,2,5,1,1,0,0,2,0,0,1,2,7,0,8,2,0,0,0,6,16,2,0,3,5,0,16,0,1,1,2,0,5,0,2,13,3,1,1,0,6,9,4,2,19,13,0,0,2,7,0,2,2,1,1,3,0,9,1,1,1,6,1,1,0,0,0,0,0,1,1,2,8,5,9,0,1,5,1,11,3,4,2,3,12,0,26,0,5,2,0,0,5,0,2,11,0,6,4,0,15,2,5,23,4,1,1,11,2,1,3,0,2,11,5,4,3,0,3,3,4,2,0,8,6,0,1,1,0,0,4,4,12,8,45,5,1,0,1,6,6,6,5,2,28,131,0,1,0,1,4,1,2,8,0,0,4,9,1,0,2,3,0,1,2,4,12,1784,0,0,5,1,1,0,0,0,4,1,1,0,0,1,3,0,4,5,0,2,1,1,1,4,1,6,0,3,8,1,1,1,0,0,1,4,5,2,2,1,12,4,1,0,1,4,3,0]

print(len(boostedVotes))
print(len(boostedComments))
print(len(controlVotes))
print(len(controlComments))

df = {"Boosted Votes": boostedVotes, "Control Votes": controlVotes}
df12 = pd.DataFrame(list(zip(boostedVotes, controlVotes)), columns=["Boosted Votes", "Control Votes"])

for col in ["Boosted Votes", "Control Votes"]:
    sns.kdeplot(data=df[col], shade=True, label=col, legend=True).set(xlim=(0,3000))

plt.legend()
plt.savefig("lagthechat.png")

plt.close()

df1 = {"Boosted Comments": boostedComments, "Control Comments": controlComments}

for col in ["Boosted Comments", "Control Comments"]:
    sns.kdeplot(data=df1[col], shade=True, label=col).set(xlim=(0,200))

plt.legend()
plt.savefig("lagthechatComs.png")
plt.close()

sns.set_theme(style="whitegrid")
#sns.boxplot(orient="v", data=df12, order=["Boosted Votes", "Control Votes"]).set(ylim=(0,4000))
sns.relplot(
    data=df12, kind="line",
    x="timepoint", y="signal", col="Boosted Votes",
    hue="event", style="event",
)

#todo -> add time series of average values over time


plt.show()
